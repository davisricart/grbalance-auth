<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty and Grace</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-remote-config-compat.js"></script>
    <script src="public-config.js"></script>
    
    <!-- For LOCAL DEVELOPMENT ONLY - NEVER commit or uncomment this line in GitHub -->
    <!-- <script src="local-dev.js"></script> -->
    <style>
        :root {--primary:#2563EB;--primary-light:#DBEAFE;--primary-dark:#1E40AF;--clear-button:#4B5563;--download-button:#10B981;--text:#1F2937;--light-text:#6B7280;--border:#E5E7EB;--background:#F9FAFB;--card-background:#fff;--success:#10B981;--success-light:#DCFCE7;--danger:#EF4444;--danger-light:#FEE2E2;--table-stripe:#F3F4F6;--shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);--shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);--transition:all .2s ease}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',-apple-system,sans-serif;background-color:var(--background);color:var(--text);line-height:1.5;padding:1.5rem}
        .container{max-width:1200px;margin:0 auto}
        .form-section{max-width:600px;margin:0 auto}
        h1{color:var(--text);font-size:1.875rem;font-weight:700;margin-bottom:2rem;letter-spacing:-.025em;text-align:center}
        h2{color:var(--text);font-size:1.5rem;font-weight:600;margin-bottom:1.5rem;text-align:center}
        h3{color:var(--text);font-size:1.25rem;font-weight:600;margin-bottom:1.25rem}
        .subtitle {
            text-align: center;
            color: var(--light-text);
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        button{padding:.625rem 1.25rem;font-weight:500;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;color:#fff;box-shadow:var(--shadow-sm);transition:var(--transition);display:inline-flex;align-items:center;justify-content:center;line-height:1.25rem}
        button:focus{outline:none;box-shadow:0 0 0 3px rgba(37,99,235,.4)}
        #compareButton{background-color:var(--primary)}
        #compareButton:hover{background-color:var(--primary-dark);box-shadow:var(--shadow)}
        #clearButton{background-color:var(--clear-button)}
        #clearButton:hover{background-color:#374151;box-shadow:var(--shadow)}
        #downloadButton{background-color:var(--download-button)}
        #downloadButton:hover{background-color:#059669;box-shadow:var(--shadow)}
        .form-label{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text);font-size:.875rem}
        .form-control{display:block;width:100%;padding:.625rem .75rem;color:var(--text);background-color:var(--card-background);border:1px solid var(--border);border-radius:.375rem;transition:var(--transition);font-size:.875rem}
        .form-control:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px rgba(37,99,235,.2)}
        .card{background-color:var(--card-background);border-radius:.5rem;box-shadow:var(--shadow-sm);padding:1.5rem;margin-bottom:1.5rem}
        .btn-group{display:flex;gap:.75rem;margin-top:1rem}
        .form-group{margin-bottom:1.25rem}
        .drop-area{border:2px dashed var(--border);border-radius:.5rem;padding:2rem 1.5rem;text-align:center;transition:var(--transition);background-color:var(--card-background);cursor:pointer}
        .drop-area.highlight{border-color:var(--primary);background-color:var(--primary-light)}
        .drop-area p{color:var(--light-text);font-size:.875rem;margin:0}
        .real-file-input{display:none}
        #status{color:var(--danger);font-size:.875rem;padding:.75rem 0;min-height:2rem}
        .table-container{overflow-x:auto;border-radius:.5rem;box-shadow:var(--shadow-sm);margin-bottom:1.5rem}
        table{width:100%;border-collapse:collapse;text-align:left;font-size:.875rem}
        th,td{padding:.75rem 1rem;border-bottom:1px solid var(--border)}
        th{background-color:var(--primary-light);color:var(--primary-dark);font-weight:600;position:sticky;top:0}
        tr:nth-child(even){background-color:var(--table-stripe)}
        tr:last-child td{border-bottom:none}
        td:first-child,th:first-child{padding-left:1.5rem}
        td:last-child,th:last-child{padding-right:1.5rem}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .fade-in{animation:fadeIn .3s ease-out forwards}
        .custom-file-input{display:flex;max-width:400px;border:1px solid var(--border);border-radius:8px;overflow:hidden;transition:all .2s ease;box-shadow:0 1px 2px rgba(0,0,0,.05);margin-bottom:.75rem}
        .custom-file-input:hover{border-color:var(--primary)}
        .custom-file-button{background-color:var(--primary);color:#fff;padding:10px 14px;border:none;cursor:pointer;font-size:.9em;white-space:nowrap;border-radius:6px;margin:2px;transition:background-color .2s ease;display:flex;align-items:center}
        .custom-file-button:hover{background-color:var(--primary-dark)}
        .custom-file-button svg{margin-right:6px}
        .custom-file-name{padding:8px 12px;font-size:.9em;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-grow:1}
        
        /* Auth Styles */
        #auth-container{max-width:600px;margin:2rem auto}
        #login-status{text-align:center;padding:.5rem;margin-bottom:1rem;font-weight:500}
        #auth-forms-container{display:flex;gap:1rem;flex-direction:column}
        @media(min-width:768px){#auth-forms-container{flex-direction:row}}
        #auth-container input{display:block;width:100%;padding:.625rem .75rem;margin-bottom:1rem;color:var(--text);background-color:var(--card-background);border:1px solid var(--border);border-radius:.375rem;transition:var(--transition);font-size:.875rem}
        #auth-container input:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px rgba(37,99,235,.2)}
        #auth-container button{width:100%}
        #login-form h2{font-size:1.5rem;margin-bottom:1.5rem;font-weight:600}
        #auth-error{color:var(--danger);margin-top:.5rem;font-size:.875rem;text-align:center}
        #main-content{display:none}
        
        /* New login form styles */
        .btn {
            background-color: var(--primary);
            color: white;
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 500;
            margin-top: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
        }
        
        .footer {
            text-align: center;
            color: var(--light-text);
            font-size: 0.875rem;
            margin-top: 2rem;
        }
        
        /* Additional Auth Styles for better error display */
        #auth-error.success {
            color: var(--success);
            background-color: var(--success-light);
            padding: 0.5rem;
            border-radius: 0.375rem;
        }
        
        #auth-error.error {
            color: var(--danger);
            background-color: var(--danger-light);
            padding: 0.5rem;
            border-radius: 0.375rem;
        }
        
        /* Loading animation */
        .loading-dots:after {
            content: '.';
            animation: loading 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }
        
        @keyframes loading {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Beauty and Grace</h1>
        <p class="subtitle">Payment Reconciliation Service</p>
        
        <div id="auth-container" class="card">
            <div id="login-status">Checking authentication status...</div>
            <div id="auth-error"></div>
            
            <form id="login-form">
                <h2>Sign In</h2>
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" name="email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
                
                <button type="submit" class="btn" id="loginButton">Sign In</button>
            </form>
            
            <button id="logout-btn" style="display:none;margin-top:1rem" class="btn">Log Out</button>
        </div>
        
        <div id="main-content" class="container">
            <form id="uploadForm">
                <div class="form-section">
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label" for="file1Input">Upload First File</label>
                            <div class="custom-file-input">
                                <button type="button" class="custom-file-button" onclick="document.getElementById('file1Input').click()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>Select File</button>
                                <span class="custom-file-name" id="file1Name">No file selected</span>
                                <input type="file" id="file1Input" class="real-file-input" accept=".xlsx" onchange="updateFileName(this, 'file1Name')">
                            </div>
                            <div class="drop-area" id="dropArea1"><p>Drag & drop your first Excel file here</p></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="file2Input">Upload Second File</label>
                            <div class="custom-file-input">
                                <button type="button" class="custom-file-button" onclick="document.getElementById('file2Input').click()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>Select File</button>
                                <span class="custom-file-name" id="file2Name">No file selected</span>
                                <input type="file" id="file2Input" class="real-file-input" accept=".xlsx" onchange="updateFileName(this, 'file2Name')">
                            </div>
                            <div class="drop-area" id="dropArea2"><p>Drag & drop your second Excel file here</p></div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label" for="scriptSelect">Select Script</label>
                            <div id="loadingScripts">Loading available scripts...</div>
                            <div id="scriptSelectContainer" style="display:none">
                                <select id="scriptSelect" class="form-control" required>
                                    <option value="">Select a script...</option>
                                    <!-- Options populated dynamically -->
                                </select>
                                <div id="scriptDescription" style="display:none"></div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button type="button" id="compareButton">Run Comparison</button>
                            <button type="button" id="clearButton">Clear Form</button>
                            <button type="button" id="downloadButton" style="display:none">Download Results</button>
                        </div>
                        <p id="status"></p>
                    </div>
                </div>
            </form>
            
            <div id="previewArea" class="fade-in" style="display:none">
                <div class="card">
                    <h3>Comparison Results</h3>
                    <div class="table-container">
                        <table id="previewTable"></table>
                    </div>
                    <div style="margin-top:1rem;display:flex;gap:1rem;font-size:.875rem">
                        <div style="display:flex;align-items:center;gap:.5rem">
                            <span style="display:inline-block;width:1rem;height:1rem;background-color:var(--danger-light);border:1px solid var(--danger)"></span>
                            <span>Negative difference</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:.5rem">
                            <span style="display:inline-block;width:1rem;height:1rem;background-color:var(--success-light);border:1px solid var(--success)"></span>
                            <span>Positive/Zero difference</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            &copy; 2025 Beauty and Grace &middot; Terms of Service &middot; Privacy Policy
        </div>
    </div>

    <script>
    // Configuration loader - works with both local dev and production
    function initializeFirebase() {
        const loginStatus = document.getElementById('login-status');
        if (loginStatus) {
            loginStatus.textContent = 'Loading configuration...';
            loginStatus.classList.add('loading-dots');
        }
        
        // Check if we're using local development config
        if (typeof firebaseConfig !== 'undefined') {
            console.log('Using local development configuration');
            // Initialize Firebase with local config
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            window.auth = auth;
            initApp(auth);
            return;
        }
        
        // If we're here, we need to load from Remote Config
        console.log('Loading configuration from Firebase Remote Config');
        
        // Create a minimal bootstrap config with no API key
        const bootstrapConfig = {
            // The only required field is projectId, which is not sensitive
            projectId: PROJECT_ID,
            
            // These are optional and help with initialization
            appId: '1:888884147701:web:ec008973a873635aba5cbc',
            
            // No API key included here - we'll get it from Remote Config
            apiKey: 'placeholder-will-be-replaced'
        };
        
        // Initialize with bootstrap config
        firebase.initializeApp(bootstrapConfig);
        
        // Set up Remote Config
        const remoteConfig = firebase.remoteConfig();
        remoteConfig.settings = {
            minimumFetchIntervalMillis: 3600000, // 1 hour
            fetchTimeoutMillis: 10000 // 10 seconds
        };
        
        // Fetch and activate config
        remoteConfig.fetchAndActivate()
            .then(() => {
                // Get the config from Remote Config
                const configValue = remoteConfig.getValue('firebase_config');
                const fullConfig = JSON.parse(configValue.asString());
                
                console.log('Configuration loaded from Remote Config');
                
                // Initialize a new Firebase instance with the full config
                firebase.initializeApp(fullConfig, 'configuredApp');
                
                // Use this auth instance
                const auth = firebase.app('configuredApp').auth();
                
                // Make auth globally available
                window.auth = auth;
                
                // Initialize your app with the proper auth
                initApp(auth);
            })
            .catch(error => {
                console.error('Error loading configuration:', error);
                
                if (loginStatus) {
                    loginStatus.textContent = 'Error loading configuration. Please refresh the page.';
                    loginStatus.classList.remove('loading-dots');
                }
                
                const status = document.getElementById('status');
                if (status) {
                    status.textContent = 'Configuration error: Unable to load Firebase configuration. Please try again later.';
                    status.style.color = 'var(--danger)';
                }
            });
    }
    
    // App variables
    const REPO_OWNER = 'davisricart';
    const REPO_NAME = 'grbalance-auth';
    const SCRIPT_PATH = 'scripts';
    
    // Script options
    const scriptOptions = [
        {value:"run5", label:"Main HUB vs Sales", description:"Compares payment data between two files and highlights discrepancies in transaction amounts."},
        {value:"N/A", label:"N/A", description:"N/A"}
    ];
    
    // Refactor your initialization code into a function that takes auth as parameter
    function initApp(auth) {
        // Update login status
        const loginStatus = document.getElementById('login-status');
        if (loginStatus) {
            loginStatus.textContent = 'Checking authentication status...';
            loginStatus.classList.remove('loading-dots');
        }
        
        // Auth elements
        const loginForm = document.getElementById('login-form');
        const loginButton = document.getElementById('loginButton');
        const logoutBtn = document.getElementById('logout-btn');
        const authError = document.getElementById('auth-error');
        const mainContent = document.getElementById('main-content');
        
        // Auth listeners - use your existing code but with the passed auth
        auth.onAuthStateChanged(user => {
            loginStatus.classList.remove('loading-dots');
            
            if (user) {
                loginStatus.textContent = `Logged in as: ${user.email}`;
                loginForm.style.display = 'none';
                logoutBtn.style.display = 'block';
                mainContent.style.display = 'block';
            } else {
                loginStatus.textContent = 'Please sign in to continue';
                loginForm.style.display = 'block';
                logoutBtn.style.display = 'none';
                mainContent.style.display = 'none';
            }
        });
        
        // Set up your event listeners with the proper auth instance
        loginForm.addEventListener('submit', e => {
            e.preventDefault();
            signIn(auth, loginForm.email.value, loginForm.password.value);
        });
        
        logoutBtn.addEventListener('click', () => {
            // Show loading indicator
            loginStatus.textContent = 'Signing you out...';
            loginStatus.classList.add('loading-dots');
            
            auth.signOut()
                .then(() => {
                    console.log('User signed out');
                    showSuccessMessage('You have been signed out successfully');
                    loginStatus.classList.remove('loading-dots');
                })
                .catch(error => {
                    console.error('Error signing out:', error);
                    showErrorMessage('Something went wrong while signing out. Please try again.');
                    loginStatus.classList.remove('loading-dots');
                });
        });
        
        // Initialize the rest of your app
        populateScriptDropdown();
        setupDragDrop(document.getElementById('dropArea1'), document.getElementById('file1Input'));
        setupDragDrop(document.getElementById('dropArea2'), document.getElementById('file2Input'));
        document.getElementById('compareButton').addEventListener('click', compareFiles);
        document.getElementById('clearButton').addEventListener('click', clearForm);
    }
    
    // Update your signIn function to accept auth as parameter
    function signIn(auth, email, password) {
        console.log(`Attempting to sign in with email: ${email}`);
        
        // Clear previous error messages
        const authError = document.getElementById('auth-error');
        authError.textContent = '';
        authError.className = '';
        
        // Show loading indicator
        const loginButton = document.getElementById('loginButton');
        const loginStatus = document.getElementById('login-status');
        loginButton.disabled = true;
        loginStatus.textContent = 'Signing you in...';
        loginStatus.classList.add('loading-dots');
        
        auth.signInWithEmailAndPassword(email, password)
            .then(userCredential => {
                console.log('User signed in successfully:', userCredential.user.email);
                authError.textContent = '';
                showSuccessMessage('Welcome back!');
                
                // Reset status
                loginStatus.textContent = `Logged in as: ${userCredential.user.email}`;
                loginStatus.classList.remove('loading-dots');
                loginButton.disabled = false;
            })
            .catch(error => {
                console.error('Sign-in error:', error.code, error.message);
                
                // Friendly error messages based on error code
                switch(error.code) {
                    case 'auth/invalid-credential':
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                        showErrorMessage('The email or password you entered is incorrect. Please try again.');
                        break;
                    case 'auth/invalid-email':
                        showErrorMessage('Please enter a valid email address.');
                        break;
                    case 'auth/user-disabled':
                        showErrorMessage('This account has been disabled. Please contact support.');
                        break;
                    case 'auth/network-request-failed':
                        showErrorMessage('Network connection issue. Please check your internet and try again.');
                        break;
                    case 'auth/too-many-requests':
                        showErrorMessage('Too many attempts. Please wait a moment before trying again.');
                        break;
                    default:
                        showErrorMessage('Unable to sign in. Please try again later.');
                }
                
                // Reset status
                loginStatus.textContent = 'Please sign in to continue';
                loginStatus.classList.remove('loading-dots');
                loginButton.disabled = false;
            });
    }
    
    // Helper function to show error messages with better styling
    function showErrorMessage(message) {
        const authError = document.getElementById('auth-error');
        authError.textContent = message;
        authError.className = 'error';
        
        // Clear message after 5 seconds
        setTimeout(() => {
            authError.style.transition = 'opacity 0.5s ease';
            authError.style.opacity = '0';
            setTimeout(() => {
                authError.textContent = '';
                authError.className = '';
                authError.style.opacity = '1';
            }, 500);
        }, 5000);
    }
    
    // Helper function to show success messages
    function showSuccessMessage(message) {
        const authError = document.getElementById('auth-error');
        authError.textContent = message;
        authError.className = 'success';
        
        // Clear message after 3 seconds
        setTimeout(() => {
            authError.style.transition = 'opacity 0.5s ease';
            authError.style.opacity = '0';
            setTimeout(() => {
                authError.textContent = '';
                authError.className = '';
                authError.style.opacity = '1';
            }, 500);
        }, 3000);
    }
    
    // App functions
    function populateScriptDropdown() {
        const selectElement = document.getElementById('scriptSelect');
        selectElement.innerHTML = '<option value="">Select a script...</option>';
        
        scriptOptions.forEach(script => {
            const option = document.createElement('option');
            option.value = script.value;
            option.textContent = script.label;
            option.dataset.description = script.description;
            selectElement.appendChild(option);
        });
        
        document.getElementById('scriptSelectContainer').style.display = 'block';
        document.getElementById('loadingScripts').style.display = 'none';
        selectElement.addEventListener('change', updateScriptDescription);
    }
    
    function updateScriptDescription() {
        const selectElement = document.getElementById('scriptSelect');
        const descriptionElement = document.getElementById('scriptDescription');
        
        if (selectElement.selectedIndex > 0) {
            const description = selectElement.options[selectElement.selectedIndex].dataset.description;
            descriptionElement.textContent = description;
            descriptionElement.style.display = 'block';
        } else {
            descriptionElement.textContent = '';
            descriptionElement.style.display = 'none';
        }
    }
    
    function setupDragDrop(dropArea, fileInput) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
            document.body.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
        });

        dropArea.addEventListener('drop', e => {
            fileInput.files = e.dataTransfer.files;
            
            if (fileInput.id === 'file1Input') {
                updateFileName(fileInput, 'file1Name');
            } else if (fileInput.id === 'file2Input') {
                updateFileName(fileInput, 'file2Name');
            }
            
            fileInput.dispatchEvent(new Event('change'));
        }, false);
    }

    function updateFileName(input, nameElementId) {
        document.getElementById(nameElementId).textContent = 
            input.files.length > 0 ? input.files[0].name : 'No file selected';
    }
    
    async function fetchComparisonScript(scriptName) {
        const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${SCRIPT_PATH}/${scriptName}.js`;
        
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Script not found. Status: ${response.status}. Please check if the script exists in the repository.`);
            }
            
            // Get the script content directly (no need for base64 decoding)
            return await response.text();
        } catch (error) {
            console.error('Error fetching script:', error);
            throw new Error('Failed to fetch the script. Please check your internet connection and try again.');
        }
    }

    function readExcelFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => resolve(e.target.result);
            reader.onerror = e => reject(e);
            reader.readAsArrayBuffer(file);
        });
    }

    async function compareFiles() {
        const file1 = document.getElementById('file1Input').files[0];
        const file2 = document.getElementById('file2Input').files[0];
        const scriptName = document.getElementById('scriptSelect').value;
        const status = document.getElementById('status');
        const previewTable = document.getElementById('previewTable');
        const previewArea = document.getElementById('previewArea');
        const downloadButton = document.getElementById('downloadButton');

        status.textContent = '';
        previewTable.innerHTML = '';
        previewArea.style.display = 'none';
        downloadButton.style.display = 'none';

        if (!file1 || !file2) {
            status.textContent = 'Please upload both files.';
            return;
        }
        if (!scriptName) {
            status.textContent = 'Please select a script.';
            return;
        }

        try {
            status.textContent = 'Fetching script...';
            let scriptContent = await fetchComparisonScript(scriptName);
            
            scriptContent = scriptContent.replace(
                /\.filter\(b => !b\.toLowerCase\(\)\.includes\("cash"\)/g, 
                '.filter(b => !b.toLowerCase().includes("cash") && !b.toLowerCase().includes("check") && !b.toLowerCase().includes("grand total")'
            );